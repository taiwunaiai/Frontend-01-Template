
## 传输层 tcp 与 http请求
在发送http请求（connection.write）之前，需先建立传输通道，而传输通道的建立由tcp完成。

## tcp 连接过程
tcp连接就是常说的“三次握手”
1. 客户端发送syn包(syn=j)到服务器，并进行 SYN_SEND 状态，等待服务器确认;
2. 服务器收到syn包,必须确认客户SYN(ack=j+1),同时向客户端发送一个SYN包(syn=k)，即SYN+ACK包，此时服务器进入SYN_RECV状态;
3. 客户端收到SYN+ACK包，向服务器发送确认包(ack=k+1),此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手
 

---
反思这过程可能出现什么问题？

## tcp 断开连接

## http 连接
HTTP是超文本传输协议，是一个简单的请求-响应协议，它通常运行在TCP之上。它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应。请求和响应消息的头以ASCII码形式给出；而消息内容则具有一个类似MIME的格式。

> 工作原理

HTTP是基于客户/服务器模式，且面向连接的。典型的HTTP事务处理有如下的过程：
1. 客户与服务器建立连接；
2. 客户向服务器提出请求；
3. 服务器接受请求，并根据请求返回相应的文件作为应答；
4. 客户与服务器关闭连接。

> 特性
- 一次性连接
    - 限制每次连接只处理一个请求，当服务器返回本次请求的应答后便立即关闭连接
    - 下次请求再重新建立连接
- 无状态协议
    - 服务器不保留与客户交易时的任何状态
    - 大大减轻了服务器记忆负担，从而保持较快的响应速度
    - 允许传送任意类型的数据对象
    
> 报文格式

## 浏览器渲染

```
graph TD
    A[浏览器]
    A --> B[DNS解析获取ip&port]
    B --> C[TCP通过ip:port建立传输通道]
    C --> D[发送http请求-获取响应内容]
    D --> E[构建DOM树]
    E --> F[计算css]
    F --> G[排版]
    G --> H[渲染和合成]
    H --> I[绘制]
```